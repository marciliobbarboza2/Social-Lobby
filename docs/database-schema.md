# Database Schema - Socialobby

## Overview
This document outlines the database schema for Socialobby, a comprehensive social media platform using MongoDB with Mongoose ODM.

## Collections

### 1. Users Collection
```javascript
{
  _id: ObjectId, // Auto-generated by MongoDB
  username: String (required, unique, 3-30 chars),
  email: String (required, unique, valid email format),
  password: String (required, hashed with bcrypt),
  firstName: String (required, 2-50 chars),
  lastName: String (required, 2-50 chars),
  bio: String (optional, max 500 chars),
  avatar: String (optional, URL to profile image),
  role: String (enum: ['user', 'admin'], default: 'user'),
  isActive: Boolean (default: true),
  lastLogin: Date,
  createdAt: Date (auto-generated),
  updatedAt: Date (auto-generated)
}
```

### 2. Posts Collection
```javascript
{
  _id: ObjectId, // Auto-generated by MongoDB
  title: String (required, 5-200 chars),
  slug: String (required, unique, auto-generated from title),
  content: String (required, min 50 chars),
  excerpt: String (optional, auto-generated from content, max 300 chars),
  featuredImage: String (optional, URL to image),
  author: ObjectId (ref: 'User', required),
  category: String (enum: ['technology', 'lifestyle', 'travel', 'food', 'health', 'business', 'other'], default: 'other'),
  tags: [String] (optional, array of tag strings),
  status: String (enum: ['draft', 'published', 'archived'], default: 'draft'),
  publishedAt: Date (set when status becomes 'published'),
  views: Number (default: 0),
  likes: Number (default: 0),
  likedBy: [ObjectId] (ref: 'User'),
  commentsCount: Number (default: 0),
  createdAt: Date (auto-generated),
  updatedAt: Date (auto-generated)
}
```

### 3. Comments Collection
```javascript
{
  _id: ObjectId, // Auto-generated by MongoDB
  content: String (required, 5-1000 chars),
  author: ObjectId (ref: 'User', required),
  post: ObjectId (ref: 'Post', required),
  parentComment: ObjectId (ref: 'Comment', optional - for nested replies),
  replies: [ObjectId] (ref: 'Comment'),
  likes: Number (default: 0),
  likedBy: [ObjectId] (ref: 'User'),
  isApproved: Boolean (default: true),
  createdAt: Date (auto-generated),
  updatedAt: Date (auto-generated)
}
```

### 4. Categories Collection (Optional - for future expansion)
```javascript
{
  _id: ObjectId,
  name: String (required, unique),
  slug: String (required, unique),
  description: String (optional),
  color: String (optional, hex color code),
  createdAt: Date (auto-generated),
  updatedAt: Date (auto-generated)
}
```

## Indexes

### Users Collection
- `username`: unique index
- `email`: unique index
- `createdAt`: descending index

### Posts Collection
- `slug`: unique index
- `author`: ascending index
- `status`: ascending index
- `publishedAt`: descending index (for published posts)
- `category`: ascending index
- `tags`: text index (for tag search)
- `title`: text index (for title search)
- `content`: text index (for content search)

### Comments Collection
- `post`: ascending index
- `author`: ascending index
- `parentComment`: ascending index
- `createdAt`: descending index

## Relationships

### One-to-Many Relationships
- **User → Posts**: One user can have many posts
- **User → Comments**: One user can have many comments
- **Post → Comments**: One post can have many comments
- **Comment → Comments**: One comment can have many replies (nested)

### Many-to-Many Relationships
- **Users ↔ Posts (Likes)**: Users can like many posts, posts can be liked by many users
- **Users ↔ Comments (Likes)**: Users can like many comments, comments can be liked by many users

## Data Validation Rules

### User Validation
- Username: 3-30 characters, alphanumeric + underscores/hyphens
- Email: Valid email format, unique
- Password: Minimum 8 characters, must contain uppercase, lowercase, number, special character
- Bio: Maximum 500 characters

### Post Validation
- Title: 5-200 characters
- Content: Minimum 50 characters
- Slug: Auto-generated from title, URL-safe
- Tags: Maximum 10 tags per post, each tag 2-30 characters

### Comment Validation
- Content: 5-1000 characters
- Nested replies: Maximum 3 levels deep

## Security Considerations

### Password Security
- Passwords hashed with bcrypt (salt rounds: 12)
- JWT tokens for authentication (expires in 7 days)
- Refresh tokens for extended sessions

### Data Sanitization
- All user inputs sanitized to prevent XSS
- HTML content filtered and escaped
- File uploads validated for type and size

### Rate Limiting
- API endpoints rate limited by IP
- User actions limited (posts per hour, comments per minute)

## Future Enhancements

### Potential New Collections
- **Notifications**: User notifications system
- **Followers**: User following/follower relationships
- **Bookmarks**: User saved posts
- **Drafts**: Auto-saved post drafts
- **Analytics**: Post view tracking and analytics

### Index Optimizations
- Compound indexes for common query patterns
- Geospatial indexes if location features added
- Time-based indexes for archiving old data
